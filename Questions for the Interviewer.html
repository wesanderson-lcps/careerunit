<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Questions for the Interviewer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* Light background for contrast */
            color: #1e293b; /* Darker text for readability */
        }
        .input-field {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #cbd5e0;
            border-radius: 0.375rem; /* rounded-md */
            background-color: #f8fafc;
        }
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #3b82f6;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-right: 8px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .collapsible-header {
            @apply flex justify-between items-center bg-gray-100 p-3 rounded-md cursor-pointer mt-4;
        }
        .collapsible-content {
            @apply p-3 border border-gray-200 rounded-b-md;
            display: none;
        }
        .collapsible-content.active {
            display: block;
        }
    </style>
</head>
<body class="p-4 sm:p-6 md:p-8 lg:p-10 bg-gray-50 min-h-screen flex items-center justify-center">
    <div id="worksheet-content" class="max-w-3xl w-full bg-white shadow-xl rounded-xl p-6 sm:p-8 md:p-10 lg:p-12 border border-gray-200 text-center">

        <h1 class="text-3xl sm:text-4xl md:text-5xl font-extrabold text-center text-blue-700 mb-6 leading-tight">
            Questions to Ask the Interviewer
        </h1>

        <p class="text-base text-gray-700 mb-8 p-4 bg-blue-50 rounded-lg border border-blue-200">
            <span class="font-bold">Directions:</span> It's important to ask thoughtful questions at the end of an interview. This shows your interest and helps you learn more about the role and company. Below are some example questions. Use the spaces provided to write down 5 questions you want to ask your interviewer. Focus on questions that demonstrate your engagement, curiosity, and understanding of the role or company. Avoid questions that can be easily answered by a quick search on the company's website.
        </p>

        <div class="mt-10 space-y-8 text-left">
            <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-4">Example Questions:</h2>
            <ul class="list-disc list-inside text-gray-700 space-y-2 mb-8">
                <li>What does a typical day look like for someone in this role?</li>
                <li>How would you describe the team culture here?</li>
                <li>What are the next steps in the hiring process?</li>
            </ul>

            <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-4">Your Questions:</h2>
            <div class="space-y-6">
                <div class="p-5 border border-gray-200 rounded-lg bg-gray-50 shadow-sm">
                    <div class="mb-3">
                        <label for="question-1" class="block text-lg font-semibold text-gray-800 mb-1">1. Your Question:</label>
                        <textarea id="question-1" class="input-field min-h-[60px] shadow-sm focus:ring-blue-500 focus:border-blue-500" placeholder="Type your question here..."></textarea>
                    </div>
                    <div>
                        <label for="explanation-1" class="block text-sm font-medium text-gray-600 mb-1">Why ask this question?</label>
                        <textarea id="explanation-1" class="input-field min-h-[40px] shadow-sm focus:ring-blue-500 focus:border-blue-500" placeholder="Explain your reason for asking this question..."></textarea>
                    </div>
                </div>

                <div class="p-5 border border-gray-200 rounded-lg bg-gray-50 shadow-sm">
                    <div class="mb-3">
                        <label for="question-2" class="block text-lg font-semibold text-gray-800 mb-1">2. Your Question:</label>
                        <textarea id="question-2" class="input-field min-h-[60px] shadow-sm focus:ring-blue-500 focus:border-blue-500" placeholder="Type your question here..."></textarea>
                    </div>
                    <div>
                        <label for="explanation-2" class="block text-sm font-medium text-gray-600 mb-1">Why ask this question?</label>
                        <textarea id="explanation-2" class="input-field min-h-[40px] shadow-sm focus:ring-blue-500 focus:border-blue-500" placeholder="Explain your reason for asking this question..."></textarea>
                    </div>
                </div>

                <div class="p-5 border border-gray-200 rounded-lg bg-gray-50 shadow-sm">
                    <div class="mb-3">
                        <label for="question-3" class="block text-lg font-semibold text-gray-800 mb-1">3. Your Question:</label>
                        <textarea id="question-3" class="input-field min-h-[60px] shadow-sm focus:ring-blue-500 focus:border-blue-500" placeholder="Type your question here..."></textarea>
                    </div>
                    <div>
                        <label for="explanation-3" class="block text-sm font-medium text-gray-600 mb-1">Why ask this question?</label>
                        <textarea id="explanation-3" class="input-field min-h-[40px] shadow-sm focus:ring-blue-500 focus:border-blue-500" placeholder="Explain your reason for asking this question..."></textarea>
                    </div>
                </div>

                <div class="p-5 border border-gray-200 rounded-lg bg-gray-50 shadow-sm">
                    <div class="mb-3">
                        <label for="question-4" class="block text-lg font-semibold text-gray-800 mb-1">4. Your Question:</label>
                        <textarea id="question-4" class="input-field min-h-[60px] shadow-sm focus:ring-blue-500 focus:border-blue-500" placeholder="Type your question here..."></textarea>
                    </div>
                    <div>
                        <label for="explanation-4" class="block text-sm font-medium text-gray-600 mb-1">Why ask this question?</label>
                        <textarea id="explanation-4" class="input-field min-h-[40px] shadow-sm focus:ring-blue-500 focus:border-blue-500" placeholder="Explain your reason for asking this question..."></textarea>
                    </div>
                </div>

                <div class="p-5 border border-gray-200 rounded-lg bg-gray-50 shadow-sm">
                    <div class="mb-3">
                        <label for="question-5" class="block text-lg font-semibold text-gray-800 mb-1">5. Your Question:</label>
                        <textarea id="question-5" class="input-field min-h-[60px] shadow-sm focus:ring-blue-500 focus:border-blue-500" placeholder="Type your question here..."></textarea>
                    </div>
                    <div>
                        <label for="explanation-5" class="block text-sm font-medium text-gray-600 mb-1">Why ask this question?</label>
                        <textarea id="explanation-5" class="input-field min-h-[40px] shadow-sm focus:ring-blue-500 focus:border-blue-500" placeholder="Explain your reason for asking this question..."></textarea>
                    </div>
                </div>
            </div>

            <div class="mt-8 p-5 border border-gray-200 rounded-lg bg-gray-50 shadow-sm">
                <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-4">Reflection:</h2>
                <div class="mb-3">
                    <label for="importance-question" class="block text-lg font-semibold text-gray-800 mb-1">Why is it important to come prepared with questions to ask the interviewer?</label>
                    <textarea id="importance-question" class="input-field min-h-[100px] shadow-sm focus:ring-blue-500 focus:border-blue-500" placeholder="Type your answer here..."></textarea>
                </div>
            </div>

            <button id="getFeedbackBtn" class="mt-8 bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-opacity-50">
                Get AI Feedback on My Questions âœ¨
            </button>

            <div id="feedback-area" class="mt-10 p-6 bg-yellow-50 rounded-lg border border-yellow-200 text-left hidden">
                <h2 class="text-xl font-bold text-yellow-800 mb-4">AI Feedback:</h2>
                <div id="feedback-content" class="text-gray-800">
                    </div>
                <div id="feedback-loading" class="text-gray-600 mt-4 hidden">
                    <span class="loading-spinner"></span> Generating feedback...
                </div>
            </div>

            <button id="downloadBtn" class="mt-8 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
                Download as Image
            </button>
            <p id="downloadStatus" class="mt-4 text-sm text-gray-600 hidden">Generating image...</p>

        </div>

    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script type="module">
        const downloadBtn = document.getElementById('downloadBtn');
        const worksheetContent = document.getElementById('worksheet-content');
        const downloadStatus = document.getElementById('downloadStatus');
        const getFeedbackBtn = document.getElementById('getFeedbackBtn');
        const feedbackArea = document.getElementById('feedback-area');
        const feedbackContent = document.getElementById('feedback-content');
        const feedbackLoading = document.getElementById('feedback-loading');

        /**
         * Downloads the content of the worksheet as a PNG image.
         */
        async function downloadWorksheetAsImage() {
            downloadBtn.disabled = true;
            downloadStatus.classList.remove('hidden');

            try {
                // Use html2canvas to capture the content of the worksheet-content div
                const canvas = await html2canvas(worksheetContent, {
                    scale: 2, // Increase scale for better resolution
                    useCORS: true, // Enable cross-origin images if any (though none are used here)
                    logging: false // Disable logging for cleaner console
                });

                // Convert the canvas to a data URL (PNG format)
                const imageDataUrl = canvas.toDataURL('image/png');

                // Create a temporary anchor element to trigger the download
                const a = document.createElement('a');
                a.href = imageDataUrl;
                a.download = 'questions_for_interviewer_responses.png'; // Set the filename for the download

                // Programmatically click the anchor to trigger the download
                document.body.appendChild(a); // Append to body (required for Firefox)
                a.click();
                document.body.removeChild(a); // Remove the temporary anchor

                downloadStatus.textContent = 'Download complete!';
            } catch (error) {
                console.error('Error generating or downloading image:', error);
                downloadStatus.textContent = 'Download failed. Please try again.';
            } finally {
                downloadBtn.disabled = false;
                setTimeout(() => {
                    downloadStatus.classList.add('hidden');
                    downloadStatus.textContent = 'Generating image...'; // Reset text for next time
                }, 3000);
            }
        }

        /**
         * Gathers user's questions and explanations and sends them to Gemini API for feedback.
         */
        async function getAIQuestionsFeedback() {
            feedbackArea.classList.remove('hidden');
            feedbackContent.innerHTML = '';
            feedbackLoading.classList.remove('hidden');
            getFeedbackBtn.disabled = true;

            const userQuestions = [];
            for (let i = 1; i <= 5; i++) {
                const questionTextarea = document.getElementById(`question-${i}`);
                const explanationTextarea = document.getElementById(`explanation-${i}`);
                userQuestions.push({
                    question: questionTextarea?.value || '',
                    explanation: explanationTextarea?.value || ''
                });
            }

            const reflection = document.getElementById('importance-question')?.value || '';

            let prompt = "Please provide constructive feedback on the following interview questions and their explanations. Evaluate their thoughtfulness, relevance, and whether they avoid easily searchable information. Suggest improvements for each question and the overall reflection. Format the feedback clearly.\n\n";

            userQuestions.forEach((item, index) => {
                prompt += `Question ${index + 1}: ${item.question}\n`;
                prompt += `Explanation ${index + 1}: ${item.explanation || "[No explanation provided]"}\n\n`;
            });

            prompt += `Overall Reflection: ${reflection || "[No reflection provided]"}\n`;

            try {
                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                const apiKey = ""; // Canvas will provide this at runtime
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;

                    // Format the feedback for display
                    const feedbackLines = text.split('\n');
                    let formattedFeedback = '';
                    let inList = false;

                    feedbackLines.forEach(line => {
                        const trimmedLine = line.trim();
                        if (trimmedLine.startsWith('Question ') && trimmedLine.includes(':') || trimmedLine.startsWith('Overall Reflection:')) {
                            if (inList) { // Close previous list if any
                                formattedFeedback += '</ul>';
                                inList = false;
                            }
                            formattedFeedback += `<h3 class="text-lg font-semibold text-gray-800 mt-4 mb-2">${trimmedLine}</h3>`;
                        } else if (trimmedLine.startsWith('- ')) {
                            if (!inList) { // Start new list
                                formattedFeedback += '<ul class="list-disc list-inside text-gray-700 mb-2">';
                                inList = true;
                            }
                            formattedFeedback += `<li class="ml-4">${trimmedLine.substring(2)}</li>`;
                        } else if (trimmedLine !== '') {
                            if (inList) { // Close previous list if any
                                formattedFeedback += '</ul>';
                                inList = false;
                            }
                            formattedFeedback += `<p class="text-gray-700 mb-1">${trimmedLine}</p>`;
                        }
                    });

                    if (inList) { // Close any open list at the end
                        formattedFeedback += '</ul>';
                    }
                    feedbackContent.innerHTML = formattedFeedback;

                } else {
                    feedbackContent.textContent = "Could not generate feedback. Please try again.";
                    console.error("Unexpected API response structure:", result);
                }
            } catch (error) {
                feedbackContent.textContent = "An error occurred while generating feedback. Please check your network connection or try again later.";
                console.error("Error fetching feedback:", error);
            } finally {
                feedbackLoading.classList.add('hidden');
                getFeedbackBtn.disabled = false;
            }
        }


        // Add event listeners
        downloadBtn.addEventListener('click', downloadWorksheetAsImage);
        getFeedbackBtn.addEventListener('click', getAIQuestionsFeedback);
    </script>
</body>
</html>
